<!DOCTYPE html>
<html lang="ro" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Dashboard ‚Äì Fabrica de Coduri</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS global -->
    <link th:href="@{/css/styles.css}" rel="stylesheet">

    <!-- Stiluri doar pentru dashboard -->
    <style>
        /* SIDEBAR DASHBOARD ‚Äì suprascrie stilul .sidebar DOAR √Æn dashboard */
        .dashboard-page .sidebar {
          background-color: #111;
          color: #fff;
          border-right: 1px solid rgba(255, 255, 255, 0.1);

          /* facem sidebar-ul full height sub navbar */
          position: fixed;
          top: 80px;
          /* navbar-ul tƒÉu are 80px */
          left: 0;
          width: 220px;
          height: calc(100vh - 80px);
          padding: 12px 0 10px;
          max-height: none;

          display: flex;
          flex-direction: column;
          overflow-y: auto;
          z-index: 10;
        }

        .dashboard-page .sidebar ul {
          padding: 0 10px;
          margin: 0;
          list-style: none;
        }

        .dashboard-page .sidebar li {
          padding: 0;
        }

        .dashboard-page .sidebar .db-user-box {
          padding: 0 14px 10px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.15);
          margin-bottom: 8px;
        }

        .dashboard-page .sidebar .db-user-name {
          margin: 0;
          font-weight: 600;
        }

        .dashboard-page .sidebar .db-user-email {
          margin: 2px 0 0;
          font-size: 0.8rem;
          opacity: 0.8;
        }

        .dashboard-page .sidebar a.db-nav-link {
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 8px;
          padding: 9px 10px;
          margin: 2px 0;
          color: #fff;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 500;
          transition: background-color 0.2s, color 0.2s, border-left 0.2s;
          border-left: 3px solid transparent;
        }

        .dashboard-page .sidebar a.db-nav-link span.db-label {
          display: inline-flex;
          align-items: center;
          gap: 6px;
        }

        .dashboard-page .sidebar a.db-nav-link span.db-badge {
          font-size: 0.75rem;
          padding: 2px 8px;
          border-radius: 999px;
          border: 1px solid rgba(255, 255, 255, 0.2);
          background: rgba(255, 255, 255, 0.06);
        }

        .dashboard-page .sidebar a.db-nav-link:hover {
          background-color: #1c1c1c;
          border-left-color: #04AA6D;
        }

        .dashboard-page .sidebar a.db-nav-link.db-active {
          background-color: #1f2a24;
          border-left-color: #04AA6D;
          color: #eafff2;
        }

        /* Logout jos √Æn sidebar */
        .dashboard-page .sidebar .db-logout-wrapper {
          margin-top: auto;
          padding: 10px 14px 12px;
          border-top: 1px solid rgba(255, 255, 255, 0.15);
        }

        .dashboard-page .sidebar .db-logout-btn {
          width: 100%;
          border-radius: 999px;
          border: 1px solid rgba(255, 255, 255, 0.2);
          background: transparent;
          color: #eee;
          padding: 6px 10px;
          font-size: 0.8rem;
          cursor: pointer;
        }

        .dashboard-page .sidebar .db-logout-btn:hover {
          border-color: #ff4b81;
          color: #ffb4cb;
        }

        /* CON»öINUT */

        .dashboard-page .content {
          color: #fff;
        }

        .dashboard-page .content-inner {
          max-width: 950px;
          margin: 0 auto 40px;
        }

        .db-header {
          margin-bottom: 16px;
        }

        .db-title {
          margin: 0 0 4px;
          font-size: 1.8rem;
        }

        .db-subtitle {
          margin: 0;
          font-size: .95rem;
          color: rgba(255, 255, 255, 0.7);
        }

        .db-badges {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin-top: 8px;
        }

        .db-badge {
          border-radius: 999px;
          border: 1px solid rgba(255, 255, 255, 0.18);
          padding: 4px 10px;
          font-size: .78rem;
          background: rgba(0, 0, 0, 0.35);
          color: rgba(255, 255, 255, 0.8);
        }

        .db-card {
          background: #222;
          border-radius: 12px;
          border: 1px solid rgba(255, 255, 255, 0.12);
          padding: 14px 14px 18px;
          margin-top: 6px;
        }

        .db-section {
          display: none;
        }

        .db-section.db-active {
          display: block;
        }

        /* Toolbar cursuri */

        .db-toolbar {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          align-items: flex-end;
          margin-bottom: 14px;
        }

        .db-field {
          display: flex;
          flex-direction: column;
          gap: 4px;
        }

        .db-label {
          font-size: .8rem;
          color: rgba(255, 255, 255, 0.7);
        }

        .db-input,
        .db-select {
          border-radius: 8px;
          border: 1px solid rgba(255, 255, 255, 0.12);
          background: #111;
          color: #fff;
          padding: 8px 10px;
          font-size: .9rem;
        }

        .db-input::placeholder {
          color: rgba(255, 255, 255, 0.45);
        }

        .db-select {
          min-width: 180px;
          appearance: none;
        }

        .db-actions {
          margin-left: auto;
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
        }

        .db-btn {
          border-radius: 8px;
          border: 1px solid transparent;
          padding: 8px 12px;
          font-size: .9rem;
          cursor: pointer;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          text-decoration: none;
        }

        .db-btn-primary {
          background: #04AA6D;
          color: #05110b;
          font-weight: 600;
        }

        .db-btn-secondary {
          background: transparent;
          color: rgba(255, 255, 255, 0.75);
          border-color: rgba(255, 255, 255, 0.25);
        }

        /* rezumat rezultate */

        .db-results-line {
          display: flex;
          justify-content: space-between;
          gap: 10px;
          align-items: center;
          flex-wrap: wrap;
          margin-bottom: 10px;
          font-size: .8rem;
          color: rgba(255, 255, 255, 0.7);
        }

        .db-chip-row {
          display: flex;
          flex-wrap: wrap;
          gap: 6px;
        }

        .db-chip {
          border-radius: 999px;
          border: 1px solid rgba(255, 255, 255, 0.18);
          padding: 3px 8px;
          font-size: .75rem;
        }

        /* grid cursuri */

        .db-course-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          /* Trei coloane egale */
          gap: 12px;
        }

        @media (max-width: 1200px) {
          .db-course-grid {
            grid-template-columns: repeat(2, 1fr);
            /* DouƒÉ coloane pe ecrane mai mici */
          }
        }

        @media (max-width: 768px) {
          .db-course-grid {
            grid-template-columns: 1fr;
            /* O singurƒÉ coloanƒÉ pe ecrane mici */
          }
        }


        .db-course-card {
    background: #262626;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.12);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 210px;
    margin: 8px 0; /* AdƒÉugƒÉm margine √Æntre carduri */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* AdƒÉugƒÉm o umbrƒÉ subtilƒÉ pentru a face cardul sƒÉ iasƒÉ √Æn eviden»õƒÉ */
    transition: transform 0.2s ease, box-shadow 0.2s ease; /* Efect de tranzi»õie la hover */
}

.db-course-card:hover {
    transform: translateY(-5px); /* Efect de ridicare a cardului la hover */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4); /* Cre»ôtem umbra la hover pentru un efect de eviden»õiere */
}


    .db-course-cover {
    width: 100%;
    height: 130px;
    object-fit: cover;
    display: block;
}

        .db-course-body {
          padding: 9px 11px 10px;
          display: flex;
          flex-direction: column;
          gap: 6px;
          flex: 1;
        }

        .db-course-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 6px;
          font-size: .7rem;
        }

        .db-pill-small {
          border-radius: 999px;
          border: 1px solid rgba(255, 255, 255, 0.18);
          padding: 3px 7px;
        }

        .db-course-title {
          margin: 2px 0 0;
          font-size: .98rem;
        }

        .db-course-title a {
          color: #fff;
          text-decoration: none;
        }

        .db-course-title a:hover {
          text-decoration: underline;
        }

        .db-course-desc {
          margin: 0;
          font-size: .82rem;
          color: rgba(255, 255, 255, 0.7);
        }

        .db-course-footer {
          padding: 0 11px 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 10px;
        }

        .db-price {
          font-weight: 700;
          font-size: .94rem;
        }

        .db-tag {
          font-size: .75rem;
          color: rgba(255, 255, 255, 0.7);
        }

        .db-course-btn {
          border-radius: 9px;
          border: none;
          padding: 7px 10px;
          font-size: .8rem;
          cursor: pointer;
          background: #04AA6D;
          color: #05110b;
          font-weight: 600;
          text-decoration: none;
        }

        /* empty state */

        .db-empty {
          padding: 32px 20px;
          text-align: center;
          border-radius: 10px;
          border: 1px dashed rgba(255, 255, 255, 0.2);
          background: #202020;
        }

        .db-empty h2 {
          margin: 0 0 8px;
          font-size: 1.1rem;
        }

        .db-empty p {
          margin: 0 0 14px;
          font-size: .9rem;
          color: rgba(255, 255, 255, 0.75);
        }

        /* sec»õiuni placeholder */

        .db-placeholder-title {
          margin: 0 0 6px;
          font-size: 1.1rem;
        }

        .db-placeholder-text {
          margin: 0;
          font-size: .9rem;
          color: rgba(255, 255, 255, 0.7);
        }

        /* TABS MOBILE ‚Äì inclusiv logout */
        .db-mobile-tabs {
          display: none;
          margin-bottom: 10px;
          border-radius: 999px;
          border: 1px solid rgba(255, 255, 255, 0.15);
          overflow: hidden;
          padding: 2px;
          background: #111;
          gap: 2px;
          align-items: stretch;
        }

        .db-mobile-tab-btn {
          flex: 1;
          border: none;
          background: transparent;
          color: rgba(255, 255, 255, 0.7);
          padding: 8px 6px;
          font-size: 0.8rem;
          cursor: pointer;
          white-space: nowrap;
        }

        .db-mobile-tab-btn.db-active {
          background: #04AA6D;
          color: #05110b;
          font-weight: 600;
          border-radius: 999px;
        }

        /* buton logout √Æn tabbar */
        .db-mobile-logout-form {
          flex: 0 0 auto;
        }

        .db-mobile-tab-btn-logout {
          padding: 8px 10px;
          font-size: 0.8rem;
        }

        @media (max-width: 1000px) {
          .db-mobile-tabs {
            display: flex;
          }
        }

        @media (max-width: 768px) {
          .dashboard-page .content-inner {
            padding: 0 4px;
          }
        }

        @media (max-width: 1000px) {
          .dashboard-page .sidebar {
            display: none;
            /* Ascunde sidebar-ul la ecrane mici */
          }

          .db-mobile-tabs {
            display: flex;
            /* AratƒÉ tab-urile mobile */
          }
        }

        .db-course-progress {
          margin-top: 10px;
          display: flex;
          flex-direction: column;
          align-items: flex-start;
        }

        .db-progress-bar {
          width: 100%;
          height: 6px;
          background-color: rgba(255, 255, 255, 0.15);
          border-radius: 3px;
          overflow: hidden;
          margin-bottom: 4px;
        }

        .db-progress-fill {
          height: 100%;
          background-color: #04AA6D;
          /* Culoare pentru progres */
          transition: width 0.3s ease;
        }

        .db-progress-label {
          font-size: 0.8rem;
          color: rgba(255, 255, 255, 0.7);
        }
    </style>
</head>

<body>

<!-- Navbar global -->
<div th:replace="~{fragments/nav :: nav}"></div>

<div class="dashboard-page">
    <div class="layout">
        <!-- SIDEBAR ST√ÇNGA -->
        <aside class="sidebar">
            <div class="db-user-box">
                <p class="db-user-name" th:text="${user.username}">username</p>
                <p class="db-user-email" th:text="${user.email}">email@exemplu.ro</p>
            </div>

            <ul>
                <li>
                    <a href="@{/dashboard/courses}" class="db-nav-link db-active">
              <span class="db-label">
                <span>üìö</span>
                <span>Cursurile mele</span>
              </span>
                        <span class="db-badge" th:text="${#lists.size(myCourses)}">0</span>
                    </a>
                </li>
                <li>
                    <a href="@{/dashboard/stats}" class="db-nav-link">
              <span class="db-label">
                <span>üìà</span>
                <span>Statistici</span>
              </span>
                        <span class="db-badge">√Æn cur√¢nd</span>
                    </a>
                </li>
                <li>
                    <a href="@{/dashboard/settings}" class="db-nav-link">
              <span class="db-label">
                <span>‚öôÔ∏è</span>
                <span>SetƒÉri cont</span>
              </span>
                        <span class="db-badge">√Æn cur√¢nd</span>
                    </a>
                </li>
            </ul>


            <div class="db-logout-wrapper">
                <form th:action="@{/logout}" method="post" class="db-mobile-logout-form">
                    <button type="submit" class="db-mobile-tab-btn db-mobile-tab-btn-logout">
                        ‚èè Logout
                    </button>
                </form>

            </div>
        </aside>

        <main class="content">
            <div class="content-inner">
                <header class="db-header">
                    <h1 class="db-title">
                        Salut,
                        <span th:text="${user.username}">coder</span> üëã
                    </h1>
                    <br>
                    <div class="db-badges">
              <span class="db-badge" th:text="${#lists.size(myCourses)} + ' cursuri √Ænscrise'">
                0 cursuri √Ænscrise
              </span>
                        <span class="db-badge">Dashboard beta</span>
                    </div>
                </header>

                <!-- Tabs mobile (c√¢nd sidebar-ul tƒÉu e ascuns) -->
                <div class="db-mobile-tabs">
                    <button class="db-mobile-tab-btn db-active" data-db-tab-mobile="courses">
                        Cursurile mele
                    </button>
                    <button class="db-mobile-tab-btn" data-db-tab-mobile="stats">
                        Statistici
                    </button>
                    <button class="db-mobile-tab-btn" data-db-tab-mobile="settings">
                        SetƒÉri
                    </button>
                    <form th:action="@{/logout}" method="post" class="db-mobile-logout-form">
                        <button type="submit" class="db-mobile-tab-btn db-mobile-tab-btn-logout">
                            ‚èè Logout
                        </button>

                    </form>
                </div>

                <section class="db-card">
                    <!-- Cursurile mele -->
                    <section id="db-tab-courses" class="db-section db-active">
                        <form class="db-toolbar" method="get" th:action="@{/dashboard}">
                            <div class="db-field" style="flex:1; min-width:220px;">
                                <label class="db-label" for="q">CautƒÉ √Æn cursurile tale</label>
                                <input id="q" name="q" class="db-input db-search-input" type="text"
                                       placeholder="Titlu, tehnologie, hashtag, descriere‚Ä¶" th:value="${query}">
                            </div>

                            <div class="db-field">
                                <label class="db-label" for="db-level">Nivel (filtru local)</label>
                                <select id="db-level" class="db-select db-filter-level">
                                    <option value="">Toate nivelurile</option>
                                    <option value="BEGINNER">√éncepƒÉtor</option>
                                    <option value="INTERMEDIATE">Intermediar</option>
                                    <option value="ADVANCED">Avansat</option>
                                </select>
                            </div>

                            <div class="db-actions">
                                <button type="submit" class="db-btn db-btn-primary">
                                    üîç CautƒÉ
                                </button>
                                <button type="button" class="db-btn db-btn-secondary db-clear-filters">
                                    Reset filtre
                                </button>
                            </div>
                        </form>

                        <div class="db-results-line">
                            <div>
                  <span id="db-courseCount" th:text="${#lists.size(myCourses)} + ' cursuri gƒÉsite'">
                    0 cursuri gƒÉsite
                  </span>
                                <span th:if="${query != null && !query.isBlank()}">
                    ‚Ä¢ filtrat dupƒÉ "<span th:text="${query}">q</span>"
                  </span>
                            </div>
                            <div class="db-chip-row">
                                <span class="db-chip">Ordine: cele mai noi cumpƒÉrate</span>
                                <span class="db-chip">Tip: Premium</span>
                            </div>
                        </div>

                        <div th:if="${#lists.isEmpty(myCourses)}" class="db-empty">
                            <h2>Nu ai √ÆncƒÉ niciun curs √Æn cont üëÄ</h2>
                            <p>
                                Mergi √Æn catalog, alege primul curs »ôi dashboard-ul se va umple cu con»õinut »ôi progres.
                            </p>
                            <a th:href="@{/cursuri}" class="db-btn db-btn-primary">
                                Vezi toate cursurile
                            </a>
                        </div>

                        <div class="db-course-grid">
                            <div th:each="own : ${myCourses}">
                                <article class="db-course-card">
                                    <a th:href="@{|/cursuri/${own.course.slug}|}">
                                        <img class="db-course-cover" th:src="${own.course.coverPath}" th:alt="${own.course.title}">
                                    </a>

                                    <div class="db-course-body">
                                        <div class="db-course-meta">
                                            <span class="db-pill-small" th:text="${own.course.technology}">Tech</span>
                                            <span class="db-pill-small" th:text="${own.course.level}">BEGINNER</span>
                                            <span class="db-pill-small" th:if="${own.course.durationMinutes != null}"
                                                  th:text="${own.course.durationLabel}">3h 20m</span>
                                        </div>

                                        <h2 class="db-course-title">
                                            <a th:href="@{|/cursuri/${own.course.slug}|}" th:text="${own.course.title}">Titlu curs</a>
                                        </h2>

                                        <p class="db-course-desc" th:text="${own.course.shortDescription}">
                                            O descriere scurtƒÉ a cursului apare aici‚Ä¶
                                        </p>

                                        <!-- Progresul Cursului -->
                                        <div class="db-course-progress">
                                            <div class="db-progress-bar">
                                                <div class="db-progress-fill" th:style="'width: ' + ${own.progress} + '%'"></div>
                                            </div>
                                            <span class="db-progress-label" th:text="${own.progress} + '% completat'"></span>
                                        </div>
                                    </div>

                                    <div class="db-course-footer">
                                        <div>
                                            <div class="db-price"
                                                 th:text="${#numbers.formatDecimal(own.course.price, 1, 'COMMA', 2, 'POINT')} + ' RON'">0,00 RON
                                            </div>
                                            <div class="db-tag">Premium ‚Ä¢ acces pe via»õƒÉ</div>
                                        </div>
                                        <a class="db-course-btn" th:href="@{|/cursuri/${own.course.slug}|}">
                                            ‚ñ∂ ContinuƒÉ cursul
                                        </a>
                                    </div>
                                </article>
                            </div>
                        </div>


                    </section>

                    <!-- Statistici -->
                    <section id="db-tab-stats" class="db-section">
                        <h2 class="db-placeholder-title">Statistici üìà</h2>
                        <p class="db-placeholder-text">
                            √én cur√¢nd vei vedea aici progresul pe cursuri, timpul petrecut »ôi alte statistici de √ÆnvƒÉ»õare.
                        </p>
                    </section>

                    <!-- SetƒÉri -->
                    <section id="db-tab-settings" class="db-section">
                        <h2 class="db-placeholder-title">SetƒÉri cont ‚öôÔ∏è</h2>
                        <p class="db-placeholder-text">
                            AceastƒÉ sec»õiune va con»õine modificarea numelui, e-mailului, parolei »ôi preferin»õele de notificare.
                        </p>
                    </section>
                </section>
            </div>
        </main>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
      // Func»õie pentru gestionarea tab-urilor pe sidebar
      const navLinks = document.querySelectorAll('.db-nav-link[data-db-tab]');
      const sections = {
        courses: document.getElementById('db-tab-courses'),
        stats: document.getElementById('db-tab-stats'),
        settings: document.getElementById('db-tab-settings')
      };

      const mobileBtns = document.querySelectorAll('.db-mobile-tab-btn[data-db-tab-mobile]');

      function activateTab(tab) {
        // sidebar
        navLinks.forEach(a => {
          a.classList.toggle('db-active', a.getAttribute('data-db-tab') === tab);
        });

        // mobile tabs
        mobileBtns.forEach(btn => {
          btn.classList.toggle('db-active', btn.getAttribute('data-db-tab-mobile') === tab);
        });

        // content sections
        Object.keys(sections).forEach(key => {
          sections[key].classList.toggle('db-active', key === tab);
        });
      }

      navLinks.forEach(a => {
        a.addEventListener('click', () => {
          const tab = a.getAttribute('data-db-tab');
          activateTab(tab);
        });
      });

      mobileBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const tab = btn.getAttribute('data-db-tab-mobile');
          activateTab(tab);
        });
      });

      // Filtru local nivel
      const levelSelect = document.querySelector('.db-filter-level');
      const cards = Array.from(document.querySelectorAll('.db-course-card-js'));
      const countEl = document.getElementById('db-courseCount');
      const clearBtn = document.querySelector('.db-clear-filters');
      const searchInput = document.querySelector('.db-search-input');

      function updateCount(visible) {
        if (!countEl) return;
        const text = visible + (visible === 1 ? ' curs gƒÉsit' : ' cursuri gƒÉsite');
        countEl.textContent = text;
      }

      function applyLevelFilter() {
        const level = (levelSelect && levelSelect.value || '').toUpperCase();
        let visible = 0;

        cards.forEach(card => {
          const cardLevel = (card.getAttribute('data-level') || '').toUpperCase();
          let show = true;

          if (level && cardLevel !== level) {
            show = false;
          }

          card.style.display = show ? '' : 'none';
          if (show) visible++;
        });

        updateCount(visible);
      }

      if (levelSelect) {
        levelSelect.addEventListener('change', applyLevelFilter);
      }

      if (clearBtn) {
        clearBtn.addEventListener('click', () => {
          if (levelSelect) levelSelect.value = '';
          if (searchInput) searchInput.value = '';
          cards.forEach(card => card.style.display = '');
          updateCount(cards.length);
        });
      }

      // Logica pentru redimensionare
      window.addEventListener('resize', function () {
        if (window.innerWidth <= 1000) {
          // Ascunde sidebar-ul la ecrane mici
          document.querySelector('.sidebar').style.display = 'none';
          // AratƒÉ tab-urile mobile
          document.querySelector('.db-mobile-tabs').style.display = 'flex';
        } else {
          // AratƒÉ sidebar-ul la ecrane mari
          document.querySelector('.sidebar').style.display = 'flex';
          // Ascunde tab-urile mobile
          document.querySelector('.db-mobile-tabs').style.display = 'none';
        }
      });
    });

</script>

</body>

</html>